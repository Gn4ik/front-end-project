(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{NQ:()=>a,Vv:()=>p,y6:()=>c,qf:()=>L});var t=document.querySelector("#card-template").content;function n(e){var n=t.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__image"),r=n.querySelector(".card__title"),u=n.querySelector(".card__like-button"),i=n.querySelector(".card__delete-button"),a=e.owner._id;a!=p&&i.remove();var l=n.querySelector(".card__likes");return e.likes.some((function(e){return e._id=="".concat(p)}))&&u.classList.add("card__like-button_is-active"),o.src=e.link,o.alt=e.name,l.textContent=e.likes.length,r.textContent=e.name,o.addEventListener("click",(function(){c.querySelector(".popup__image").src=o.src,c.querySelector(".popup__caption").textContent=r.textContent,L(c)})),u.addEventListener("click",(function(){u.classList.toggle("card__like-button_is-active"),u.classList.contains("card__like-button_is-active")?function(e,t){fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards/likes/".concat(e._id),{method:"PUT",headers:{authorization:"882243f8-1d22-45b3-a374-62b2578708ea"}}).then((function(e){return e.json()})).then((function(n){e.likes=n.likes,t.textContent=e.likes.length}))}(e,l):function(e,t){fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards/likes/".concat(e._id),{method:"DELETE",headers:{authorization:"882243f8-1d22-45b3-a374-62b2578708ea"}}).then((function(e){return e.json()})).then((function(n){e.likes=n.likes,t.textContent=e.likes.length}))}(e,l)})),a==p&&i.addEventListener("click",(function(){var t,n=i.closest(".card");t=e._id,fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards/".concat(t),{method:"DELETE",headers:{authorization:"882243f8-1d22-45b3-a374-62b2578708ea"}}),n.remove()})),n}var o=document.querySelector(".popup_type_edit"),r=document.querySelector(".popup_type_new_image"),u=document.querySelector(".popup_type_new-card"),c=document.querySelector(".popup_type_image");o.classList.add("popup_is-animated"),u.classList.add("popup_is-animated"),c.classList.add("popup_is-animated"),r.classList.add("popup_is-animated");var i,a,p,l=document.querySelector(".places__list"),s=o.querySelector('form[name="edit-profile"]'),d=s.querySelector('[type="submit"]'),_=document.querySelector(".profile__edit-button"),f=o.querySelector(".popup__close"),y=r.querySelector('form[name="edit-avatar"]'),m=document.querySelector(".profile__image"),v=y.querySelector('[type="submit"]'),h=r.querySelector(".popup__close"),S=u.querySelector('form[name="new-place"]'),q=u.querySelector('[type="submit"]'),b=document.querySelector(".profile__add-button"),k=u.querySelector(".popup__close"),g=c.querySelector(".popup__close");function E(e){"Escape"===e.key&&C(document.querySelector(".popup_is-opened"))}function L(e){e.classList.add("popup_is-opened"),e.addEventListener("mousedown",(function(t){var n=t.target;n.closest(".popup__content")||C(e),n.classList.contains("popup__close")&&C(n.closest(".popup"))})),document.addEventListener("keydown",E)}function C(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",E)}function x(e,t){e.nextElementSibling.textContent=t,e.classList.add("popup__input_type_error")}function T(e){e.nextElementSibling.textContent="",e.classList.remove("popup__input_type_error")}function j(){var e,t,n=0==(e=s.querySelector(".popup__input_type_name")).value.length?(x(e,"Вы пропустили это поле"),!1):e.value.length<2||e.value.length>40?(x(e,"Имя должно быть от 2 до 40 символов"),!1):(T(e),!0),o=0==(t=s.querySelector(".popup__input_type_description")).value.length?(x(t,"Вы пропустили это поле"),!1):t.value.length<2||t.value.length>200?(x(t,"Описание должно быть от 2 до 200 символов"),!1):(T(t),!0);d.disabled=!(n&&o)}function w(e){var t=e.querySelector(".popup__input_type_url");return 0==t.value.length?(x(t,"Вы пропустили это поле"),!1):function(e){try{return new URL(e),!0}catch(e){return!1}}(t.value)?(T(t),!0):(x(t,"Введите адрес сайта"),!1)}function z(){var e,t=0==(e=u.querySelector(".popup__input_type_card-name")).value.length?(x(e,"Вы пропустили это поле"),!1):e.value.length<2||e.value.length>30?(x(e,"Название должно быть от 2 до 30 символов"),!1):(T(e),!0),n=w(u);q.disabled=!(t&&n)}function O(){var e=w(r);v.disabled=!e}fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/users/me",{method:"GET",headers:{authorization:"882243f8-1d22-45b3-a374-62b2578708ea"}}).then((function(e){return e.json()})).then((function(e){p=(i=e)._id,i&&(document.querySelector(".profile__title").textContent=i.name,document.querySelector(".profile__description").textContent=i.about,document.querySelector(".profile__image").style.backgroundImage="url(".concat(i.avatar,")"))})),fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards",{method:"GET",headers:{authorization:"882243f8-1d22-45b3-a374-62b2578708ea"}}).then((function(e){return e.json()})).then((function(e){a=e,function(){var e=document.querySelector(".places__list");a.forEach((function(t){var o=n(t);e.append(o)}))}()})),s.querySelectorAll(".popup__input").forEach((function(e){e.addEventListener("input",j)})),S.querySelectorAll(".popup__input").forEach((function(e){e.addEventListener("input",z)})),y.querySelectorAll(".popup__input").forEach((function(e){e.addEventListener("input",O)})),_.addEventListener("click",(function(){return e=document.querySelector(".profile__title").textContent,t=document.querySelector(".profile__description").textContent,s.querySelector(".popup__input_type_name").value=e,s.querySelector(".popup__input_type_description").value=t,d.disabled=!1,j(),void L(o);var e,t})),f.addEventListener("click",(function(){return C(o)})),s.addEventListener("submit",(function(e){e.preventDefault(),document.querySelector(".profile__title").textContent=s.querySelector(".popup__input_type_name").value,document.querySelector(".profile__description").textContent=s.querySelector(".popup__input_type_description").value,fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/users/me",{method:"PATCH",headers:{authorization:"882243f8-1d22-45b3-a374-62b2578708ea","Content-Type":"application/json"},body:JSON.stringify({name:s.querySelector(".popup__input_type_name").value,about:s.querySelector(".popup__input_type_description").value})}),C(o)})),m.addEventListener("click",(function(){return L(r)})),h.addEventListener("click",(function(){return C(o)})),y.addEventListener("submit",(function(e){e.preventDefault();var t=y.querySelector(".popup__input_type_url").value;fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/users/me/avatar",{method:"PATCH",headers:{authorization:"882243f8-1d22-45b3-a374-62b2578708ea","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return e.json()})).then((function(e){document.querySelector(".profile__image").style.backgroundImage="url(".concat(t,")"),C(r)})).catch((function(e){console.log("Ошибка при обновлении аватара:",e)}))})),b.addEventListener("click",(function(){return L(u)})),k.addEventListener("click",(function(){return C(u)})),S.addEventListener("submit",(function(e){e.preventDefault();var t,o,r=S.querySelector(".popup__input_type_card-name"),c=S.querySelector(".popup__input_type_url"),i={name:r.value,link:c.value,owner:{_id:p},likes:[]};r.value="",c.value="",t=i.name,o=i.link,fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards",{method:"POST",headers:{authorization:"882243f8-1d22-45b3-a374-62b2578708ea","Content-Type":"application/json"},body:JSON.stringify({name:t,link:o,likes:[]})});var a=n(i);l.insertBefore(a,l.firstChild),C(u)})),g.addEventListener("click",(function(){return C(c)}))})();