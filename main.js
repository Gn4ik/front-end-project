(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Nj:()=>s,NQ:()=>p,Vv:()=>l,y6:()=>c,qf:()=>j});var t=document.querySelector("#card-template").content;function n(e){var n=t.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__image"),r=n.querySelector(".card__title"),u=n.querySelector(".card__like-button"),i=n.querySelector(".card__delete-button"),a=e.owner._id;a!=l&&i.remove();var p=n.querySelector(".card__likes");return e.likes.some((function(e){return e._id=="".concat(l)}))&&u.classList.add("card__like-button_is-active"),o.src=e.link,o.alt=e.name,p.textContent=e.likes.length,r.textContent=e.name,o.addEventListener("click",(function(){c.querySelector(".popup__image").src=o.src,c.querySelector(".popup__caption").textContent=r.textContent,j(c)})),u.addEventListener("click",(function(){u.classList.toggle("card__like-button_is-active"),u.classList.contains("card__like-button_is-active")?function(e,t){fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards/likes/".concat(e._id),{method:"PUT",headers:{authorization:s}}).then((function(e){return e.json()})).then((function(n){e.likes=n.likes,t.textContent=e.likes.length}))}(e,p):function(e,t){fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards/likes/".concat(e._id),{method:"DELETE",headers:{authorization:s}}).then((function(e){return e.json()})).then((function(n){e.likes=n.likes,t.textContent=e.likes.length}))}(e,p)})),a==l&&i.addEventListener("click",(function(){var t,n=i.closest(".card");t=e._id,fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards/".concat(t),{method:"DELETE",headers:{authorization:s}}),n.remove()})),n}var o=document.querySelector(".popup_type_edit"),r=document.querySelector(".popup_type_new_image"),u=document.querySelector(".popup_type_new-card"),c=document.querySelector(".popup_type_image"),i=document.querySelector(".popup_auth");o.classList.add("popup_is-animated"),u.classList.add("popup_is-animated"),c.classList.add("popup_is-animated"),r.classList.add("popup_is-animated");var a,p,l,s,d=document.querySelector(".places__list"),_=i.querySelector('form[name="auth"]'),y=o.querySelector('form[name="edit-profile"]'),f=y.querySelector('[type="submit"]'),m=document.querySelector(".profile__edit-button"),v=o.querySelector(".popup__close"),h=r.querySelector('form[name="edit-avatar"]'),S=document.querySelector(".profile__image"),q=h.querySelector('[type="submit"]'),k=r.querySelector(".popup__close"),E=u.querySelector('form[name="new-place"]'),L=u.querySelector('[type="submit"]'),g=document.querySelector(".profile__add-button"),b=u.querySelector(".popup__close"),C=c.querySelector(".popup__close");function x(e){"Escape"===e.key&&T(document.querySelector(".popup_is-opened"))}function j(e){e.classList.add("popup_is-opened"),e!=i&&(e.addEventListener("mousedown",(function(t){var n=t.target;n.closest(".popup__content")||T(e),n.classList.contains("popup__close")&&T(n.closest(".popup"))})),document.addEventListener("keydown",x))}function T(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",x)}function w(e,t){e.nextElementSibling.textContent=t,e.classList.add("popup__input_type_error")}function z(e){e.nextElementSibling.textContent="",e.classList.remove("popup__input_type_error")}function O(){var e,t,n=0==(e=y.querySelector(".popup__input_type_name")).value.length?(w(e,"Вы пропустили это поле"),!1):e.value.length<2||e.value.length>40?(w(e,"Имя должно быть от 2 до 40 символов"),!1):(z(e),!0),o=0==(t=y.querySelector(".popup__input_type_description")).value.length?(w(t,"Вы пропустили это поле"),!1):t.value.length<2||t.value.length>200?(w(t,"Описание должно быть от 2 до 200 символов"),!1):(z(t),!0);f.disabled=!(n&&o)}function D(e){var t=e.querySelector(".popup__input_type_url");return 0==t.value.length?(w(t,"Вы пропустили это поле"),!1):function(e){try{return new URL(e),!0}catch(e){return!1}}(t.value)?(z(t),!0):(w(t,"Введите адрес сайта"),!1)}function N(){var e,t=0==(e=u.querySelector(".popup__input_type_card-name")).value.length?(w(e,"Вы пропустили это поле"),!1):e.value.length<2||e.value.length>30?(w(e,"Название должно быть от 2 до 30 символов"),!1):(z(e),!0),n=D(u);L.disabled=!(t&&n)}function P(){var e=D(r);q.disabled=!e}j(i),y.querySelectorAll(".popup__input").forEach((function(e){e.addEventListener("input",O)})),E.querySelectorAll(".popup__input").forEach((function(e){e.addEventListener("input",N)})),h.querySelectorAll(".popup__input").forEach((function(e){e.addEventListener("input",P)})),m.addEventListener("click",(function(){return e=document.querySelector(".profile__title").textContent,t=document.querySelector(".profile__description").textContent,y.querySelector(".popup__input_type_name").value=e,y.querySelector(".popup__input_type_description").value=t,f.disabled=!1,O(),void j(o);var e,t})),v.addEventListener("click",(function(){return T(o)})),y.addEventListener("submit",(function(e){e.preventDefault(),document.querySelector(".profile__title").textContent=y.querySelector(".popup__input_type_name").value,document.querySelector(".profile__description").textContent=y.querySelector(".popup__input_type_description").value,fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/users/me",{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({name:y.querySelector(".popup__input_type_name").value,about:y.querySelector(".popup__input_type_description").value})}),T(o)})),S.addEventListener("click",(function(){return j(r)})),k.addEventListener("click",(function(){return T(o)})),h.addEventListener("submit",(function(e){e.preventDefault();var t=h.querySelector(".popup__input_type_url").value;fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/users/me/avatar",{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return e.json()})).then((function(e){document.querySelector(".profile__image").style.backgroundImage="url(".concat(t,")"),T(r)})).catch((function(e){console.log("Ошибка при обновлении аватара:",e)}))})),_.addEventListener("submit",(function(e){e.preventDefault(),function(e){fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/users/me",{method:"GET",headers:{authorization:e}}).then((function(e){return e.json()})).then((function(e){l=(a=e)._id,a&&(document.querySelector(".profile__title").textContent=a.name,document.querySelector(".profile__description").textContent=a.about,document.querySelector(".profile__image").style.backgroundImage="url(".concat(a.avatar,")"))}))}(s=_.querySelector(".popup__input_type_name").value),fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards",{method:"GET",headers:{authorization:s}}).then((function(e){return e.json()})).then((function(e){p=e,function(){var e=document.querySelector(".places__list");p.forEach((function(t){var o=n(t);e.append(o)}))}()})),T(i)})),g.addEventListener("click",(function(){return j(u)})),b.addEventListener("click",(function(){return T(u)})),E.addEventListener("submit",(function(e){e.preventDefault();var t,o,r=E.querySelector(".popup__input_type_card-name"),c=E.querySelector(".popup__input_type_url"),i={name:r.value,link:c.value,owner:{_id:l},likes:[]};r.value="",c.value="",t=i.name,o=i.link,fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards",{method:"POST",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:o,likes:[]})});var a=n(i);d.insertBefore(a,d.firstChild),T(u)})),C.addEventListener("click",(function(){return T(c)}))})();